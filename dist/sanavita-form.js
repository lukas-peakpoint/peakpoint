(()=>{var T=".w-checkbox-input",v=".w-radio-input",L="w--redirected-checked",y='[data-form-element="component"]',F="form",q='[data-form-element="success"]',P='[data-form-element="error"]',_='[data-form-element="submit"]',C=`.w-checkbox input[type="checkbox"]:not(${T})`,H='.w-radio input[type="radio"]',m=`.w-input, .w-select, ${H}, ${C}`,k='[data-steps-element="component"]',D='[data-steps-element="list"]',x='[data-steps-element="step"]';var G="button[data-step-target]",$='[data-steps-nav="prev"]',V='[data-steps-nav="next"]';var z='[data-form-array-element="list"]',B='[data-person-element="template"]',K='[data-person-element="empty"]',j='[data-person-element="add"]',U='[data-person-element="save"]',Y='[data-person-element="cancel"]',W="[data-person-data-group]",X='[data-form-element="modal"]';var le=document.documentElement.dataset.wfSite||"",J=document.documentElement.dataset.wfPage||"",p=class{fields;constructor(e=new Map){this.fields=e}getField(e){return this.fields.get(e)}},M=class{personalData;doctor;health;relatives;constructor(e=new p,t=new p,s=new p,o=new p){this.personalData=e,this.doctor=t,this.health=s,this.relatives=o}getFullName(){return`${this.personalData.getField("first-name").value} ${this.personalData.getField("name").value}`.trim()}},S=class{id;label;value;required;type;checked;constructor(e,t){e.type==="radio"&&!e.checked||(this.id=e.id||Z(e.dataset.name||`field ${t}`),this.label=e.dataset.name||`field ${t}`,this.value=e.value,this.required=e.required||!1,this.type=e.type,(f(e)||E(e))&&(this.checked=e.checked))}},b=class{container;messageFor;messageElement;constructor(e,t){this.container=e,this.messageFor=t,this.messageElement=this.container.querySelector(`[data-message-component="FormGroup"][data-message-for="${t}"]`),this.reset()}info(e=null){this.setMessage(e,"info")}error(e=null){this.setMessage(e,"error")}reset(){this.messageElement?this.messageElement.classList.remove("info","error"):console.warn("Message element not found.")}setMessage(e=null,t){if(!this.messageElement){console.warn("Message element not found.");return}let s=this.messageElement.querySelector('[data-message-element="message"]');s&&e?s.textContent=e:s||console.warn("Message text element not found."),this.messageElement.classList.remove("info","error"),this.messageElement.classList.add(t)}},A=class{form;container;groupNames;validationMessage;formMessage;constructor(e,t,s){this.container=e,this.groupNames=t,this.validationMessage=s;let o=this.getAllGroupFields()[0].closest("form");if(!o){console.error("Cannot construct a FormGroup that is not part of a form.");return}this.form=o,this.formMessage=new b(this.form,this.groupNames.join(",")),this.initialize()}initialize(){this.getAllGroupFields().forEach(t=>{t.addEventListener("change",()=>this.formMessage.reset())})}getGroupFields(e){return this.container.querySelectorAll(`[data-form-group="${e}"]`)}getAllGroupFields(){let t=this.groupNames.map(s=>`[data-form-group="${s}"]`).join(", ");return this.container.querySelectorAll(t)}validate(){console.log("VALIDATING FORM GROUPS: ",this.groupNames);let e=this.checkGroupValidity();return this.handleValidationMessages(e),console.log(e),e}checkGroupValidity(){return this.groupNames.some(e=>Array.from(this.getGroupFields(e)).some(s=>E(s)||f(s)?s.checked:s.value.trim()!==""))}updateRequiredAttributes(e){this.getAllGroupFields().forEach(s=>{s.required=!e}),this.formMessage.reset()}handleValidationMessages(e){e?this.formMessage.reset():this.formMessage.error()}},w=class{component;formSteps;paginationItems;buttonNext;buttonPrev;currentStep=0;customValidators=[];constructor(e){this.component=e,this.formSteps=this.component.querySelectorAll(x),this.paginationItems=this.component.querySelectorAll(G),this.buttonNext=this.component.querySelector(V),this.buttonPrev=this.component.querySelector($),this.initialize()}addCustomValidator(e,t){this.customValidators[e]||(this.customValidators[e]=[]),this.customValidators[e].push(t)}initialize(){if(!this.component.getAttribute("data-steps-element")){console.error(`Form Steps: Component is not a steps component or is missing the attribute ${k}.
Component:`,this.component);return}if(!this.formSteps.length){console.warn("Form Steps: The selected list doesn't contain any steps. Skipping initialization. Provided List:",this.component.querySelector(D));return}this.setupSteps(),this.initPagination(),this.changeToStep(this.currentStep,!0)}setupSteps(){this.formSteps.forEach((e,t)=>{e.dataset.stepId=t.toString(),e.classList.toggle("hide",t!==0)})}initPagination(){this.paginationItems.forEach((e,t)=>{e.dataset.stepTarget=t.toString(),e.addEventListener("click",s=>{s.preventDefault(),this.changeToStep(t)})}),this.buttonNext.addEventListener("click",e=>{e.preventDefault(),this.currentStep<this.formSteps.length-1&&this.changeToStep(this.currentStep+1)}),this.buttonPrev.addEventListener("click",e=>{e.preventDefault(),this.currentStep>0&&this.changeToStep(this.currentStep-1)})}changeToStep(e,t=!1){if(this.currentStep===e&&!t){console.log("Change Form Step: Target step equals current step.");return}if(e>this.currentStep&&!t){for(let o=this.currentStep;o<e;o++)if(!this.validateCurrentStep(o)){console.warn("Standard validation failed for step:",o+1),this.changeToStep(o);return}this.component.scrollIntoView({behavior:"smooth"})}let s=new CustomEvent("changeStep",{detail:{previousStep:this.currentStep,currentStep:e}});this.component.dispatchEvent(s),this.updateStepVisibility(e),this.updatePagination(e),this.currentStep=e}updateStepVisibility(e){this.formSteps[this.currentStep].classList.add("hide"),this.formSteps[e].classList.remove("hide")}updatePagination(e){this.buttonPrev.style.opacity=e===0?"0":"1",this.buttonNext.style.opacity=e===this.formSteps.length-1?"0":"1",this.paginationItems.forEach((t,s)=>{t.classList.toggle("is-done",s<e),t.classList.toggle("is-active",s===e)})}validateAllSteps(){let e=!0;return this.formSteps.forEach((t,s)=>{this.validateCurrentStep(s)||(console.warn(`Step ${s+1} is invalid.`),e=!1,this.changeToStep(s))}),e}validateCurrentStep(e){let t=this.formSteps[e],s=t.querySelectorAll(m),o=I(s);if(!o)return console.warn("STANDARD VALIDATION: NOT VALID"),o;let r=this.customValidators[e]?.every(c=>c())??!0;if(!r)return console.warn("CUSTOM VALIDATION: NOT VALID"),o&&r;let i=t.querySelector('[data-form-array-element="list"]');if(!i)return o&&r;let l=parseInt(i.dataset.length)>0;if(!l){console.warn("Couldn't validate current step. Please add at least one person.");let c=i.parentElement.querySelector('[data-person-element="empty"]');c.setAttribute("aria-live","assertive"),c.setAttribute("role","alert"),c.setAttribute("tabindex","-1"),c.classList.add("has-error"),ee(c)}return o&&r&&l}},O=class{component;list;template;emptyState;addButton;modal;modalForm;saveButton;cancelButtons;modalInputs;groupElements;editingKey=null;constructor(e){this.component=e,this.list=this.component.querySelector(z),this.template=this.list.querySelector(B),this.emptyState=this.component.querySelector(K),this.addButton=this.component.querySelector(j),this.modal=document.querySelector(X),this.modalForm=document.querySelector(F),this.saveButton=this.modal.querySelector(U),this.cancelButtons=this.modal.querySelectorAll(Y),this.modalInputs=this.modal.querySelectorAll(m),this.groupElements=this.modal.querySelectorAll(W),this.initialize()}initialize(){this.cancelButtons.forEach(e=>{e.addEventListener("click",this.closeModal.bind(this))}),this.addButton.addEventListener("click",this.handleAddButtonClick.bind(this)),this.saveButton.addEventListener("click",this.savePerson.bind(this)),this.closeModal()}handleAddButtonClick(){this.clearModal(),this.setLiveText("state","Hinzuf\xFCgen"),this.setLiveText("full-name","Neue Person"),this.openModal(),this.editingKey=null}savePerson(){if(!this.validateModal())return console.warn("Couldn't save person. Please fill in all the values correctly."),null;let e=this.extractData();if(this.editingKey!==null)u.set(this.editingKey,e);else{let t=`person${u.size+1}`;u.set(t,e)}return this.renderList(),this.closeModal(),e}setLiveText(e,t){let s=this.modal.querySelectorAll(`[data-live-text="${e}"]`),o=!0;for(let r of s){if(!r){o=!1;break}r.innerText=t}return o}renderList(){this.list.innerHTML="",this.list.dataset.length=u.size.toString(),console.log(u.size.toString()),u.size?(u.forEach((e,t)=>this.renderPerson(e,t)),this.emptyState.classList.add("hide")):this.emptyState.classList.remove("hide")}renderPerson(e,t){let s=this.template.cloneNode(!0),o=["first-name","name","phone","email","street","zip","city"];s.style.removeProperty("display");let r=s.querySelector('[data-person-action="edit"]'),i=s.querySelector('[data-person-action="delete"]');r.addEventListener("click",()=>{this.setLiveText("state","bearbeiten"),this.setLiveText("full-name",e.getFullName()||"Neue Person"),this.populateModal(e),this.openModal(),this.editingKey=t}),i.addEventListener("click",()=>{u.delete(t),this.renderList(),this.closeModal()}),o.forEach(a=>{let l=`[data-${a}]`,c=s.querySelector(l);if(c){let d=e.personalData.getField(a);if(!d){console.error(`Render person: A field for "${a}" doesn't exist.`);return}c.innerText=d.value||d.label}}),this.list.appendChild(s)}populateModal(e){this.groupElements.forEach(t=>{let s=t.querySelectorAll(m),o=t.dataset.personDataGroup;s.forEach(r=>{let i=e[o].getField(r.id);if(!i){console.warn("Field not found:",i,r.id);return}if(!f(r)&&!E(r)){r.value=i.value.trim();return}f(r)&&r.value===i.value&&(r.checked=i.checked,r.dispatchEvent(new Event("change",{bubbles:!0}))),E(r)&&(r.checked=i.checked,r.dispatchEvent(new Event("change",{bubbles:!0})))})})}openModal(){this.modal.querySelector('[data-person-data-group="personalData"]').querySelectorAll("#first-name, #name").forEach(s=>{s.addEventListener("input",()=>{let o=this.extractData();this.setLiveText("full-name",o.getFullName()||"Neue Person")})}),this.emptyState.classList.remove("has-error"),this.modal.style.removeProperty("display"),this.modal.classList.remove("is-closed"),this.modal.dataset.state="open"}closeModal(){this.modal.classList.add("is-closed"),this.modal.dataset.state="closed",setTimeout(()=>{this.modal.style.display="none"},500),this.clearModal()}clearModal(){this.setLiveText("state","hinzuf\xFCgen"),this.setLiveText("full-name","Neue Person"),this.modalInputs.forEach(e=>{f(e)?(e.checked=!1,oe(this.modal,e.name)):E(e)?(e.checked=!1,e.dispatchEvent(new Event("change",{bubbles:!0}))):e.value=""})}validateModal(){let e=this.modal.querySelectorAll(m);return I(e)}extractData(){let e=new M;return this.groupElements.forEach(t=>{let s=t.querySelectorAll(m),o=t.dataset.personDataGroup;if(!e[o]){console.error(`The group "${o}" doesn't exist.`);return}s.forEach((r,i)=>{let a=new S(r,i);a.id&&e[o].fields.set(a.id,a)})}),console.log(e),e}};function Z(n){return n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").replace(/-+/g,"-")}function h(n){let e={};for(let[t,s]of n)e[t]=s instanceof Map?h(s):s;return e}function Q(n){let e={};for(let[t,s]of n)e[t]={personalData:{fields:h(s.personalData.fields)},doctor:{fields:h(s.doctor.fields)},health:{fields:h(s.health.fields)},relatives:{fields:h(s.relatives.fields)}};return e}function ee(n){if(!n||!n.firstElementChild){console.warn("Element or its first element child is not defined.");return}let e=n.firstElementChild;n.removeChild(e),setTimeout(()=>{n.appendChild(e),n.focus()},0)}function f(n){return n instanceof HTMLInputElement&&n.type==="radio"}function E(n){return n instanceof HTMLInputElement&&n.type==="checkbox"}function te(n){if(!n)return console.error("Form component not found:",y),!1;let e=n.querySelector(F);if(!e)return console.error(`The selected form component does not contain a HTMLFormElement. Perhaps you added ${y} to the form element itself rather than its parent element?

Form Component:`,n),!1;ne(e),re(n),ie(n);let t=new w(n),s=new O(n),o=new A(n,["upload","post"],"validation message");return t.addCustomValidator(2,()=>o.validate()),t.component.addEventListener("changeStep",()=>s.closeModal()),e.setAttribute("novalidate",""),e.dataset.state="initialized",n.addEventListener("submit",r=>{r.preventDefault(),o.validate(),t.validateAllSteps(),e.dataset.state="sending",se(n,e)}),!0}async function se(n,e){function t(){i&&(i.style.display="block"),e.style.display="none",e.dataset.state="success",e.dispatchEvent(new CustomEvent("formSuccess"))}function s(){a&&(a.style.display="block"),e.dataset.state="error",e.dispatchEvent(new CustomEvent("formError"))}let o=[{id:"custom-submit",label:"Custom Submit",value:!0,required:!1}],r=e.querySelectorAll(m),i=n.querySelector(q),a=n.querySelector(P),l=n.querySelector(_);if(!(l instanceof HTMLInputElement)||l.type!=="submit")throw new Error('The submitButton element is not an HTML input element with type="submit".');l.dataset.defaultText=l.value,l.value=l.dataset.wait||"Wird gesendet ...",r.forEach((g,R)=>{let ae=new S(g,R);o.push()}),o.people=Q(u),console.log("FORM FIELDS:",o),window.PEAKPOINT.fields=o;let c=e.querySelector("#g-recaptcha-response").value,d={name:e.dataset.name,pageId:J,elementId:e.dataset.wfElementId,source:window.location.href,test:!1,fields:{fields:JSON.stringify({fields:o}),"g-recaptcha-response":c},dolphin:!1};l.value=l.dataset.defaultText}function ne(n){n.querySelectorAll("button").forEach(t=>{t.setAttribute("type","button"),t.addEventListener("click",s=>{})})}function oe(n,e){n.querySelectorAll(`${H}[name="${e}"]`).forEach(t=>{t.checked=!1;let s=t.closest(".w-radio")?.querySelector(v);s&&s.classList.remove(L)})}function re(n){let e="w--redirected-focus",t="w--redirected-focus-visible",s=":focus-visible, [data-wf-focus-visible]",o=[["checkbox",T],["radio",v]];n.querySelectorAll(C).forEach(r=>{r.addEventListener("change",i=>{let a=i.target,l=a.closest(".w-checkbox")?.querySelector(T);l&&l.classList.toggle(L,a.checked)})}),n.querySelectorAll('input[type="radio"]').forEach(r=>{r.addEventListener("change",i=>{let a=i.target;if(!a.checked)return;let l=a.name;n.querySelectorAll(`input[type="radio"][name="${l}"]`).forEach(d=>{let g=d.closest(".w-radio")?.querySelector(v);g&&g.classList.remove(L)});let c=a.closest(".w-radio")?.querySelector(v);c&&c.classList.add(L)})}),o.forEach(([r,i])=>{n.querySelectorAll(`input[type="${r}"]:not(${i})`).forEach(a=>{a.addEventListener("focus",l=>{let c=l.target,d=c.closest(".w-checkbox, .w-radio")?.querySelector(i);d&&(d.classList.add(e),c.matches(s)&&d.classList.add(t))}),a.addEventListener("blur",l=>{let d=l.target.closest(".w-checkbox, .w-radio")?.querySelector(i);d&&d.classList.remove(e,t)})})})}function ie(n){n.querySelectorAll("[data-decision-group]").forEach(t=>{let s=t.querySelectorAll("input[data-decision]"),o=t.dataset.decisionGroup,r=document.querySelector(`[data-decision-extra-fields="${o}"]`);if(s.length===0){console.error(`Decision group "${o}" does not contain any decision input elements.`);return}if(!r){console.error(`Extra fields container for decision group "${o}" not found.`);return}r.style.display="none",t.addEventListener("change",i=>{let a=i.target;a.matches("input[data-decision]")&&a.dataset.decision==="show"?r.style.display="block":r.style.display="none"})})}function I(n){let e=!0;for(let t of n)if(t.checkValidity())t.classList.remove("has-error");else{e=!1,t.reportValidity(),t.classList.add("has-error"),t.addEventListener("change",()=>{t.classList.remove("has-error")});break}return e}window.PEAKPOINT={};var u=new Map;window.PEAKPOINT.people=u;var N=document.querySelector(y);N?.classList.remove("w-form");document.addEventListener("DOMContentLoaded",()=>{let n=te(N);console.log("Form initialized:",n)});})();
