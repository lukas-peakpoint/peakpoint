(()=>{var S=".w-checkbox-input",E=".w-radio-input",g="w--redirected-checked",H='[data-form-element="component"]',A="form",P='[data-form-element="success"]',R='[data-form-element="error"]',q='[data-form-element="submit"]',O=`.w-checkbox input[type="checkbox"]:not(${S})`,I='.w-radio input[type="radio"]',u=`.w-input, .w-select, ${I}, ${O}`,k='[data-steps-element="component"]',_='[data-steps-element="list"]',D='[data-steps-element="step"]';var x="button[data-step-target]",V='[data-steps-nav="prev"]',B='[data-steps-nav="next"]';var G='[data-form-array-element="list"]',$='[data-person-element="template"]';var z='[data-person-element="add"]',K='[data-person-element="save"]',U='[data-person-element="cancel"]',W="[data-person-data-group]",j='[data-form-element="modal"]',Y='[data-modal-element="scroll"]',J='[data-animate="accordion"]';var X=document.documentElement.dataset.wfSite||"",Z=document.documentElement.dataset.wfPage||"",b=class{component;trigger;uiTrigger;isOpen=!1;icon;constructor(e){this.component=e,this.trigger=e.querySelector('[data-animate="trigger"]'),this.uiTrigger=e.querySelector('[data-animate="ui-trigger"]'),this.icon=e.querySelector('[data-animate="icon"]'),this.uiTrigger.addEventListener("click",()=>{this.toggle()})}open(){this.isOpen||(this.trigger.click(),setTimeout(()=>{this.icon.classList.add("is-open")},200),this.isOpen=!0)}close(){this.isOpen&&(this.trigger.click(),setTimeout(()=>{this.icon.classList.remove("is-open")},200),this.isOpen=!1)}toggle(){this.isOpen?this.close():this.open()}scrollIntoView(){let e=0,t=this.component.closest(Y),s=this.uiTrigger.getBoundingClientRect().top;if(t){let i=t.getBoundingClientRect().top;e=t.querySelector('[data-scroll-child="sticky"]').clientHeight,t.scrollBy({top:s-i-e-2,behavior:"smooth"})}else window.scrollTo({top:s+window.scrollY-e-2,behavior:"smooth"})}},m=class{fields;constructor(e=new Map){this.fields=e}getField(e){return this.fields.get(e)}},T=class{personalData;doctor;health;relatives;constructor(e=new m,t=new m,s=new m,i=new m){this.personalData=e,this.doctor=t,this.health=s,this.relatives=i}validate(){let e=!0;return Object.keys(this).forEach(s=>{let i=this[s];i.fields&&i.fields.forEach(o=>{o.validate(!0)||(e=!1)})}),e}getFullName(){return`${this.personalData.getField("first-name").value} ${this.personalData.getField("name").value}`.trim()||"Neue Person"}},v=class{id;label;value;required;type;checked;constructor(e,t){e.type==="radio"&&!e.checked||(this.id=e.id||Q(e.dataset.name||`field ${t}`),this.label=e.dataset.name||`field ${t}`,this.value=e.value,this.required=e.required||!1,this.type=e.type,(h(e)||f(e))&&(this.checked=e.checked))}validate(e=!0){let t=!0;return this.required&&(this.type==="radio"||this.type==="checkbox"?this.checked||(t=!1):this.value.trim()||(t=!1)),!t&&e&&console.warn(`Field "${this.label}" is invalid.`),t}},L=class{messageFor;component;messageElement;constructor(e,t){this.messageFor=t;let s=document.querySelector(`[data-message-component="${e}"][data-message-for="${this.messageFor}"]`);if(!s){console.warn("No FormMessage component was found.");return}this.component=s,this.messageElement=this.component?.querySelector('[data-message-element="message"]')||null,this.reset()}info(e=null){this.component.setAttribute("aria-live","polite"),this.setMessage(e,"info")}error(e=null){this.component.setAttribute("role","alert"),this.component.setAttribute("aria-live","assertive"),this.setMessage(e,"error")}reset(){this.component.classList.remove("info","error")}setMessage(e=null,t){this.messageElement&&e?this.messageElement.textContent=e:this.messageElement||console.warn("Message text element not found."),this.component.classList.remove("info","error"),this.component.classList.add(t),this.component.scrollIntoView({behavior:"smooth",block:"center"})}},y=class{form;container;groupNames;validationMessage;formMessage;constructor(e,t,s){this.container=e,this.groupNames=t,this.validationMessage=s;let i=this.getAllGroupFields()[0].closest("form");if(!i){console.error("Cannot construct a FormGroup that is not part of a form.");return}this.form=i,this.formMessage=new L("FormGroup",this.groupNames.join(",")),this.initialize()}initialize(){this.getAllGroupFields().forEach(t=>{t.addEventListener("change",()=>this.formMessage.reset())})}getGroupFields(e){return this.container.querySelectorAll(`[data-form-group="${e}"]`)}getAllGroupFields(){let t=this.groupNames.map(s=>`[data-form-group="${s}"]`).join(", ");return this.container.querySelectorAll(t)}validate(){console.log("VALIDATING FORM GROUPS: ",this.groupNames);let e=this.checkGroupValidity();return this.handleValidationMessages(e),console.log(e),e}checkGroupValidity(){return this.groupNames.some(e=>Array.from(this.getGroupFields(e)).some(s=>f(s)||h(s)?s.checked:s.value.trim()!==""))}updateRequiredAttributes(e){this.getAllGroupFields().forEach(s=>{s.required=!e}),this.formMessage.reset()}handleValidationMessages(e){e?this.formMessage.reset():this.formMessage.error()}},M=class{id;people;container;list;template;formMessage;addButton;modal;modalForm;saveButton;cancelButtons;modalInputs;groupElements;accordionList=[];editingKey=null;constructor(e,t){this.id=t,this.container=e,this.people=new Map,this.list=this.container.querySelector(G),this.template=this.list.querySelector($),this.addButton=this.container.querySelector(z),this.formMessage=new L("FormArray",this.id.toString()),this.modal=document.querySelector(j),this.modalForm=document.querySelector(A),this.saveButton=this.modal.querySelector(K),this.cancelButtons=this.modal.querySelectorAll(U),this.modalInputs=this.modal.querySelectorAll(u),this.groupElements=this.modal.querySelectorAll(W),this.initialize()}initialize(){this.cancelButtons.forEach(t=>{t.addEventListener("click",this.closeModal.bind(this))}),this.modalInputs.forEach(t=>{t.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),this.savePersonFromModal())})}),this.addButton.addEventListener("click",()=>this.handleAddButtonClick()),this.saveButton.addEventListener("click",()=>this.savePersonFromModal()),this.renderList(),this.closeModal();let e=this.container.querySelectorAll(J);for(let t=0;t<e.length;t++){let s=e[t];s.dataset.index=t.toString();let i=new b(s);this.accordionList.push(i),i.uiTrigger.addEventListener("click",()=>{this.openAccordion(t),setTimeout(()=>{i.scrollIntoView()},500)})}this.openAccordion(0)}openAccordion(e){for(let t=0;t<this.accordionList.length;t++){let s=this.accordionList[t];t===e&&!s.isOpen?s.open():t!==e&&s.isOpen&&s.close()}}handleAddButtonClick(){this.clearModal(),this.setLiveText("state","Hinzuf\xFCgen"),this.setLiveText("full-name","Neue Person"),this.openModal(),this.editingKey=null}savePersonFromModal(e=!0){if(!this.validateModal(e)&&(console.warn("Couldn't save person. Please fill in all the values correctly."),e))return null;let s=this.extractData();this.savePerson(s)&&(this.renderList(),this.closeModal())}savePerson(e){if(this.editingKey!==null)this.people.set(this.editingKey,e);else{let t=crypto.randomUUID(),s=`person${this.people.size+1}`;this.people.set(s,e)}return!0}setLiveText(e,t){let s=this.modal.querySelectorAll(`[data-live-text="${e}"]`),i=!0;for(let o of s){if(!o){i=!1;break}o.innerText=t}return i}renderList(){this.list.innerHTML="",this.list.dataset.length=this.people.size.toString(),this.people.size?(this.people.forEach((e,t)=>this.renderPerson(e,t)),this.formMessage.reset()):this.formMessage.info("Bitte f\xFCgen Sie die Mieter (max. 2 Personen) hinzu.")}renderPerson(e,t){let s=this.template.cloneNode(!0),i=["full-name","phone","email","street","zip","city"];s.style.removeProperty("display");let o=s.querySelector('[data-person-action="edit"]'),a=s.querySelector('[data-person-action="delete"]');o.addEventListener("click",()=>{this.setLiveText("state","bearbeiten"),this.setLiveText("full-name",e.getFullName()||"Neue Person"),this.populateModal(e),this.openModal(),this.editingKey=t}),a.addEventListener("click",()=>{this.people.delete(t),this.renderList(),this.closeModal()}),i.forEach(r=>{let d=`[data-${r}]`,c=s.querySelector(d);if(c&&r==="full-name")c.innerText=e.getFullName();else if(c){let l=e.personalData.getField(r);if(!l){console.error(`Render person: A field for "${r}" doesn't exist.`);return}c.innerText=l.value||l.label}}),this.list.appendChild(s)}populateModal(e){this.groupElements.forEach(t=>{let s=t.querySelectorAll(u),i=t.dataset.personDataGroup;s.forEach(o=>{let a=e[i].getField(o.id);if(!a){console.warn("Field not found:",a,o.id);return}if(!h(o)&&!f(o)){o.value=a.value.trim();return}h(o)&&o.value===a.value&&(o.checked=a.checked,o.dispatchEvent(new Event("change",{bubbles:!0}))),f(o)&&(o.checked=a.checked,o.dispatchEvent(new Event("change",{bubbles:!0})))})})}validateArray(){let e=!0;return this.people.size===0?(console.warn("Bitte f\xFCgen Sie mindestens eine mietende Person hinzu."),this.formMessage.error("Bitte f\xFCgen Sie mindestens eine mietende Person hinzu."),setTimeout(()=>this.formMessage.info("Bitte f\xFCgen Sie die Mieter (max. 2 Personen) hinzu."),5e3),e=!1):this.people.forEach((t,s)=>{t.validate()||(console.warn(`Bitte f\xFCllen Sie alle Felder f\xFCr "${t.getFullName()}" aus.`),this.formMessage.error(`Bitte f\xFCllen Sie alle Felder f\xFCr "${t.getFullName()}" aus.`),e=!1)}),e}openModal(){this.modal.querySelector('[data-person-data-group="personalData"]').querySelectorAll("#first-name, #name").forEach(s=>{s.addEventListener("input",()=>{let i=this.extractData();this.setLiveText("full-name",i.getFullName()||"Neue Person")})}),this.formMessage.info(),this.openAccordion(0),this.modal.style.removeProperty("display"),this.modal.classList.remove("is-closed"),this.modal.dataset.state="open",document.body.style.overflow="hidden"}closeModal(){document.body.style.removeProperty("overflow"),this.modal.classList.add("is-closed"),this.modal.dataset.state="closed",this.list.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{this.modal.style.display="none"},500),this.clearModal()}clearModal(){this.setLiveText("state","hinzuf\xFCgen"),this.setLiveText("full-name","Neue Person"),this.modalInputs.forEach(e=>{h(e)?(e.checked=!1,ie(this.modal,e.name)):f(e)?(e.checked=!1,e.dispatchEvent(new Event("change",{bubbles:!0}))):e.value=""})}validateModal(e=!0){let t=this.modal.querySelectorAll(u),{valid:s,invalidField:i}=N(t,e);if(s===!0)return!0;if(i){let o=this.accordionIndexOf(i);return o!==-1&&(this.openAccordion(o),setTimeout(()=>{i.scrollIntoView({behavior:"smooth",block:"center"})},500)),!1}return!1}accordionIndexOf(e){let t=e.closest('[data-animate="accordion"]');if(t){let s=this.accordionList.findIndex(i=>i.component===t);return s!==-1?s:-1}return-1}extractData(){let e=new T;return this.groupElements.forEach(t=>{let s=t.querySelectorAll(u),i=t.dataset.personDataGroup;if(!e[i]){console.error(`The group "${i}" doesn't exist.`);return}s.forEach((o,a)=>{let r=new v(o,a);r.id&&e[i].fields.set(r.id,r)})}),console.log(e),e}},w=class{component;formElement;formSteps;paginationItems;buttonNext;buttonPrev;currentStep=0;customValidators=[];peopleArray;beilagenGroup;successElement;errorElement;submitButton;constructor(e){if(this.component=e,this.formElement=this.component.querySelector(A),!this.formElement)throw new Error("Form element not found within the specified component.");this.formSteps=this.component.querySelectorAll(D),this.paginationItems=this.component.querySelectorAll(x),this.buttonNext=this.component.querySelector(B),this.buttonPrev=this.component.querySelector(V),this.successElement=this.component.querySelector(P),this.errorElement=this.component.querySelector(R),this.submitButton=this.component.querySelector(q),this.initialize()}addCustomValidator(e,t){this.customValidators[e]||(this.customValidators[e]=[]),this.customValidators[e].push(t)}initialize(){if(!this.component.getAttribute("data-steps-element")){console.error(`Form Steps: Component is not a steps component or is missing the attribute ${k}.
Component:`,this.component);return}if(!this.formSteps.length){console.warn("Form Steps: The selected list doesn't contain any steps. Skipping initialization. Provided List:",this.component.querySelector(_));return}se(this.formElement),oe(this.component),ne(this.component),this.setupSteps(),this.initPagination(),this.changeToStep(this.currentStep,!0),this.peopleArray=new M(this.component,"personArray"),this.beilagenGroup=new y(this.component,["upload","post"],"validation message"),this.addCustomValidator(3,()=>this.beilagenGroup.validate()),this.addCustomValidator(2,()=>this.peopleArray.validateArray()),this.component.addEventListener("changeStep",()=>this.peopleArray.closeModal()),this.formElement.setAttribute("novalidate",""),this.formElement.dataset.state="initialized",this.formElement.addEventListener("submit",e=>{e.preventDefault(),this.submitToWebflow()})}async submitToWebflow(){if(!this.validateAllSteps()){console.warn("Form submission blocked: Not all steps are valid.");return}this.formElement.dataset.state="sending",this.submitButton&&(this.submitButton.dataset.defaultText=this.submitButton.value,this.submitButton.value=this.submitButton.dataset.wait||"Wird gesendet ...");let t=this.buildJsonForWebflow();console.log(t),await te(t)?this.onFormSuccess():this.onFormError()}buildJsonForWebflow(){let e={...p(this.getAllFormData()),people:ee(this.peopleArray.people)},t=this.formElement.querySelector("#g-recaptcha-response").value;return{name:this.formElement.dataset.name,pageId:Z,elementId:this.formElement.dataset.wfElementId,source:window.location.href,test:!1,fields:{fields:JSON.stringify(e),"g-recaptcha-response":t},dolphin:!1}}onFormSuccess(){this.successElement&&(this.successElement.style.display="block"),this.formElement.style.display="none",this.formElement.dataset.state="success",this.formElement.dispatchEvent(new CustomEvent("formSuccess")),this.submitButton&&(this.submitButton.value=this.submitButton.dataset.defaultText||"Submit")}onFormError(){this.errorElement&&(this.errorElement.style.display="block"),this.formElement.dataset.state="error",this.formElement.dispatchEvent(new CustomEvent("formError")),this.submitButton&&(this.submitButton.value=this.submitButton.dataset.defaultText||"Submit")}setupSteps(){this.formSteps.forEach((e,t)=>{e.dataset.stepId=t.toString(),e.classList.toggle("hide",t!==0),e.querySelectorAll(u).forEach(s=>{s.addEventListener("keydown",i=>{i.key==="Enter"&&(i.preventDefault(),this.changeToNext())})})})}initPagination(){this.paginationItems.forEach((e,t)=>{e.dataset.stepTarget=t.toString(),e.addEventListener("click",s=>{s.preventDefault(),this.changeToStep(t)})}),this.buttonNext.addEventListener("click",e=>{e.preventDefault(),this.changeToNext()}),this.buttonPrev.addEventListener("click",e=>{e.preventDefault(),this.changeToPrevious()})}changeToNext(){this.currentStep<this.formSteps.length-1&&this.changeToStep(this.currentStep+1)}changeToPrevious(){this.currentStep>0&&this.changeToStep(this.currentStep-1)}changeToStep(e,t=!1){if(this.currentStep===e&&!t){console.log("Change Form Step: Target step equals current step.");return}if(e>this.currentStep&&!t){for(let i=this.currentStep;i<e;i++)if(!this.validateCurrentStep(i)){console.warn("Standard validation failed for step:",i+1),this.changeToStep(i);return}this.component.scrollIntoView({behavior:"smooth",block:"start"})}let s=new CustomEvent("changeStep",{detail:{previousStep:this.currentStep,currentStep:e}});this.component.dispatchEvent(s),this.updateStepVisibility(e),this.updatePagination(e),this.currentStep=e}updateStepVisibility(e){this.formSteps[this.currentStep].classList.add("hide"),this.formSteps[e].classList.remove("hide")}updatePagination(e){e===0?(this.buttonPrev.style.visibility="hidden",this.buttonPrev.style.opacity="0"):e===this.formSteps.length-1?(this.buttonNext.style.visibility="hidden",this.buttonNext.style.opacity="0"):(this.buttonPrev.style.visibility="visible",this.buttonPrev.style.opacity="1",this.buttonNext.style.visibility="visible",this.buttonNext.style.opacity="1"),this.paginationItems.forEach((t,s)=>{t.classList.toggle("is-done",s<e),t.classList.toggle("is-active",s===e)})}validateAllSteps(){let e=!0;return this.formSteps.forEach((t,s)=>{this.validateCurrentStep(s)||(console.warn(`Step ${s+1} is invalid.`),e=!1,this.changeToStep(s))}),e}validateCurrentStep(e){let s=this.formSteps[e].querySelectorAll(u),{valid:i,invalidField:o}=N(s);if(!i)return console.warn("STANDARD VALIDATION: NOT VALID"),i;let a=this.customValidators[e]?.every(r=>r())??!0;return a||console.warn("CUSTOM VALIDATION: NOT VALID"),i&&a}getFormDataForStep(e){let t=new Map;return this.formSteps[e].querySelectorAll(u).forEach((o,a)=>{let r=new v(o,a);r.id&&t.set(r.id,r)}),t}getAllFormData(){let e=new Map;return this.formSteps.forEach((t,s)=>{let i=this.getFormDataForStep(s);e=new Map([...e,...i])}),e}};function Q(n){return n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").replace(/-+/g,"-")}function p(n){let e={};for(let[t,s]of n)e[t]=s instanceof Map?p(s):s;return e}function ee(n){let e={};for(let[t,s]of n)e[t]={personalData:{fields:p(s.personalData.fields)},doctor:{fields:p(s.doctor.fields)},health:{fields:p(s.health.fields)},relatives:{fields:p(s.relatives.fields)}};return e}function h(n){return n instanceof HTMLInputElement&&n.type==="radio"}function f(n){return n instanceof HTMLInputElement&&n.type==="checkbox"}async function te(n){let e=`https://webflow.com/api/v1/form/${X}`,t={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript, */*; q=0.01"},body:JSON.stringify(n)};try{let s=await fetch(e,t);if(!s.ok)throw new Error(`Network response "${s.status}" was not okay`);return console.log("Form submission success! Status",s.status),!0}catch(s){return console.error("Form submission failed:",s),!1}}function se(n){n.querySelectorAll("button").forEach(t=>{t.setAttribute("type","button"),t.addEventListener("click",s=>{})})}function ie(n,e){n.querySelectorAll(`${I}[name="${e}"]`).forEach(t=>{t.checked=!1;let s=t.closest(".w-radio")?.querySelector(E);s&&s.classList.remove(g)})}function oe(n){let e="w--redirected-focus",t="w--redirected-focus-visible",s=":focus-visible, [data-wf-focus-visible]",i=[["checkbox",S],["radio",E]];n.querySelectorAll(O).forEach(o=>{o.addEventListener("change",a=>{let r=a.target,d=r.closest(".w-checkbox")?.querySelector(S);d&&d.classList.toggle(g,r.checked)})}),n.querySelectorAll('input[type="radio"]').forEach(o=>{o.addEventListener("change",a=>{let r=a.target;if(!r.checked)return;let d=r.name;n.querySelectorAll(`input[type="radio"][name="${d}"]`).forEach(l=>{let F=l.closest(".w-radio")?.querySelector(E);F&&F.classList.remove(g)});let c=r.closest(".w-radio")?.querySelector(E);c&&c.classList.add(g)})}),i.forEach(([o,a])=>{n.querySelectorAll(`input[type="${o}"]:not(${a})`).forEach(r=>{r.addEventListener("focus",d=>{let c=d.target,l=c.closest(".w-checkbox, .w-radio")?.querySelector(a);l&&(l.classList.add(e),c.matches(s)&&l.classList.add(t))}),r.addEventListener("blur",d=>{let l=d.target.closest(".w-checkbox, .w-radio")?.querySelector(a);l&&l.classList.remove(e,t)})})})}function ne(n){n.querySelectorAll("[data-decision-group]").forEach(t=>{let s=t.querySelectorAll("input[data-decision]"),i=t.dataset.decisionGroup,o=document.querySelector(`[data-decision-extra-fields="${i}"]`);if(s.length===0){console.error(`Decision group "${i}" does not contain any decision input elements.`);return}if(!o){console.error(`Extra fields container for decision group "${i}" not found.`);return}o.style.display="none",t.addEventListener("change",a=>{let r=a.target;r.matches("input[data-decision]")&&r.dataset.decision==="show"?o.style.display="block":o.style.display="none"})})}function N(n,e=!0){let t=!0,s=null;for(let i of n)if(i.checkValidity())i.classList.remove("has-error");else{t=!1,e&&!s&&(i.reportValidity(),i.classList.add("has-error"),i.addEventListener("change",()=>{i.classList.remove("has-error")},{once:!0}),s=i);break}return{valid:t,invalidField:s}}window.PEAKPOINT={};var C=document.querySelector(H);C?.classList.remove("w-form");document.addEventListener("DOMContentLoaded",()=>{if(window.location.search){let e=new URLSearchParams(window.location.search),t=document.querySelector("#wohnung"),s=e.get("wohnung"),i=t.querySelector(`option[value="${s}"]`);s&&i?t.value=s:console.warn(`No matching option for value: ${s}`)}let n=new w(C);console.log("Form initialized:",n)});})();
