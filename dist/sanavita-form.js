(()=>{var T=".w-checkbox-input",g=".w-radio-input",v="w--redirected-checked",y='[data-form-element="component"]',I="form",q='[data-form-element="success"]',k='[data-form-element="error"]',_='[data-form-element="submit"]',N=`.w-checkbox input[type="checkbox"]:not(${T})`,P='.w-radio input[type="radio"]',p=`.w-input, .w-select, ${P}, ${N}`,D='[data-steps-element="component"]',x='[data-steps-element="list"]',V='[data-steps-element="step"]';var $="button[data-step-target]",G='[data-steps-nav="prev"]',B='[data-steps-nav="next"]';var z='[data-form-array-element="list"]',K='[data-person-element="template"]';var U='[data-person-element="add"]',j='[data-person-element="save"]',Y='[data-person-element="cancel"]',W="[data-person-data-group]",X='[data-form-element="modal"]',J='[data-modal-element="scroll"]',Z='[data-animate="accordion"]';var ae=document.documentElement.dataset.wfSite||"",Q=document.documentElement.dataset.wfPage||"",b=class{component;trigger;uiTrigger;isOpen=!1;constructor(e){this.component=e,this.trigger=e.querySelector('[data-animate="trigger"]'),this.uiTrigger=e.querySelector('[data-animate="ui-trigger"]'),this.uiTrigger.addEventListener("click",()=>{this.toggle()})}open(){this.isOpen||(this.trigger.click(),this.isOpen=!0)}close(){this.isOpen&&(this.trigger.click(),this.isOpen=!1)}toggle(){this.isOpen?this.close():this.open()}scrollIntoView(){let e=0,t=this.component.closest(J),s=this.uiTrigger.getBoundingClientRect().top;if(t){let n=t.getBoundingClientRect().top;e=t.querySelector('[data-scroll-child="sticky"]').clientHeight,t.scrollBy({top:s-n-e-2,behavior:"smooth"})}else window.scrollTo({top:s+window.scrollY-e-2,behavior:"smooth"})}},m=class{fields;constructor(e=new Map){this.fields=e}getField(e){return this.fields.get(e)}},M=class{personalData;doctor;health;relatives;constructor(e=new m,t=new m,s=new m,n=new m){this.personalData=e,this.doctor=t,this.health=s,this.relatives=n}validate(){let e=!0;return Object.keys(this).forEach(s=>{let n=this[s];n.fields&&n.fields.forEach(i=>{i.validate(!0)||(e=!1)})}),e}getFullName(){return`${this.personalData.getField("first-name").value} ${this.personalData.getField("name").value}`.trim()||"Neue Person"}},L=class{id;label;value;required;type;checked;constructor(e,t){e.type==="radio"&&!e.checked||(this.id=e.id||H(e.dataset.name||`field ${t}`),this.label=e.dataset.name||`field ${t}`,this.value=e.value,this.required=e.required||!1,this.type=e.type,(f(e)||E(e))&&(this.checked=e.checked))}validate(e=!0){let t=!0;return this.required&&(this.type==="radio"||this.type==="checkbox"?this.checked||(t=!1):this.value.trim()||(t=!1)),!t&&e&&console.warn(`Field "${this.label}" is invalid.`),t}},S=class{messageFor;component;messageElement;constructor(e,t){this.messageFor=t;let s=document.querySelector(`[data-message-component="${e}"][data-message-for="${this.messageFor}"]`);if(!s){console.warn("No FormMessage component was found.");return}this.component=s,this.messageElement=this.component?.querySelector('[data-message-element="message"]')||null,this.reset()}info(e=null){this.component.setAttribute("aria-live","polite"),this.setMessage(e,"info")}error(e=null){this.component.setAttribute("role","alert"),this.component.setAttribute("aria-live","assertive"),this.setMessage(e,"error")}reset(){this.component.classList.remove("info","error")}setMessage(e=null,t){this.messageElement&&e?this.messageElement.textContent=e:this.messageElement||console.warn("Message text element not found."),this.component.classList.remove("info","error"),this.component.classList.add(t),this.component.scrollIntoView({behavior:"smooth",block:"center"})}},A=class{form;container;groupNames;validationMessage;formMessage;constructor(e,t,s){this.container=e,this.groupNames=t,this.validationMessage=s;let n=this.getAllGroupFields()[0].closest("form");if(!n){console.error("Cannot construct a FormGroup that is not part of a form.");return}this.form=n,this.formMessage=new S("FormGroup",this.groupNames.join(",")),this.initialize()}initialize(){this.getAllGroupFields().forEach(t=>{t.addEventListener("change",()=>this.formMessage.reset())})}getGroupFields(e){return this.container.querySelectorAll(`[data-form-group="${e}"]`)}getAllGroupFields(){let t=this.groupNames.map(s=>`[data-form-group="${s}"]`).join(", ");return this.container.querySelectorAll(t)}validate(){console.log("VALIDATING FORM GROUPS: ",this.groupNames);let e=this.checkGroupValidity();return this.handleValidationMessages(e),console.log(e),e}checkGroupValidity(){return this.groupNames.some(e=>Array.from(this.getGroupFields(e)).some(s=>E(s)||f(s)?s.checked:s.value.trim()!==""))}updateRequiredAttributes(e){this.getAllGroupFields().forEach(s=>{s.required=!e}),this.formMessage.reset()}handleValidationMessages(e){e?this.formMessage.reset():this.formMessage.error()}},w=class{component;formSteps;paginationItems;buttonNext;buttonPrev;currentStep=0;customValidators=[];constructor(e){this.component=e,this.formSteps=this.component.querySelectorAll(V),this.paginationItems=this.component.querySelectorAll($),this.buttonNext=this.component.querySelector(B),this.buttonPrev=this.component.querySelector(G),this.initialize()}addCustomValidator(e,t){this.customValidators[e]||(this.customValidators[e]=[]),this.customValidators[e].push(t)}initialize(){if(!this.component.getAttribute("data-steps-element")){console.error(`Form Steps: Component is not a steps component or is missing the attribute ${D}.
Component:`,this.component);return}if(!this.formSteps.length){console.warn("Form Steps: The selected list doesn't contain any steps. Skipping initialization. Provided List:",this.component.querySelector(x));return}this.setupSteps(),this.initPagination(),this.changeToStep(this.currentStep,!0)}setupSteps(){this.formSteps.forEach((e,t)=>{e.dataset.stepId=t.toString(),e.classList.toggle("hide",t!==0),e.querySelectorAll(p).forEach(s=>{s.addEventListener("keydown",n=>{n.key==="Enter"&&(n.preventDefault(),this.changeToNext())})})})}initPagination(){this.paginationItems.forEach((e,t)=>{e.dataset.stepTarget=t.toString(),e.addEventListener("click",s=>{s.preventDefault(),this.changeToStep(t)})}),this.buttonNext.addEventListener("click",e=>{e.preventDefault(),this.changeToNext()}),this.buttonPrev.addEventListener("click",e=>{e.preventDefault(),this.changeToPrevious()})}changeToNext(){this.currentStep<this.formSteps.length-1&&this.changeToStep(this.currentStep+1)}changeToPrevious(){this.currentStep>0&&this.changeToStep(this.currentStep-1)}changeToStep(e,t=!1){if(this.currentStep===e&&!t){console.log("Change Form Step: Target step equals current step.");return}if(e>this.currentStep&&!t){for(let n=this.currentStep;n<e;n++)if(!this.validateCurrentStep(n)){console.warn("Standard validation failed for step:",n+1),this.changeToStep(n);return}this.component.scrollIntoView({behavior:"smooth",block:"start"})}let s=new CustomEvent("changeStep",{detail:{previousStep:this.currentStep,currentStep:e}});this.component.dispatchEvent(s),this.updateStepVisibility(e),this.updatePagination(e),this.currentStep=e}updateStepVisibility(e){this.formSteps[this.currentStep].classList.add("hide"),this.formSteps[e].classList.remove("hide")}updatePagination(e){e===0?(this.buttonPrev.style.visibility="hidden",this.buttonPrev.style.opacity="0"):e===this.formSteps.length-1?(this.buttonNext.style.visibility="hidden",this.buttonNext.style.opacity="0"):(this.buttonPrev.style.visibility="visible",this.buttonPrev.style.opacity="1",this.buttonNext.style.visibility="visible",this.buttonNext.style.opacity="1"),this.paginationItems.forEach((t,s)=>{t.classList.toggle("is-done",s<e),t.classList.toggle("is-active",s===e)})}validateAllSteps(){let e=!0;return this.formSteps.forEach((t,s)=>{this.validateCurrentStep(s)||(console.warn(`Step ${s+1} is invalid.`),e=!1,this.changeToStep(s))}),e}validateCurrentStep(e){let s=this.formSteps[e].querySelectorAll(p),{valid:n,invalidField:i}=R(s);if(!n)return console.warn("STANDARD VALIDATION: NOT VALID"),n;let r=this.customValidators[e]?.every(a=>a())??!0;return r||console.warn("CUSTOM VALIDATION: NOT VALID"),n&&r}getFormDataForStep(e){let t=[];return this.formSteps[e].querySelectorAll(p).forEach((i,r)=>{let a=new L(i,r);a.id&&t.push(a)}),t}getAllFormData(){let e=[];return this.formSteps.forEach((t,s)=>{let n=this.getFormDataForStep(s);e.push(...n)}),e}},F=class{id;container;list;template;formMessage;addButton;modal;modalForm;saveButton;cancelButtons;modalInputs;groupElements;accordionList=[];editingKey=null;constructor(e,t){this.id=t,this.container=e,this.list=this.container.querySelector(z),this.template=this.list.querySelector(K),this.addButton=this.container.querySelector(U),this.formMessage=new S("FormArray",this.id.toString()),this.modal=document.querySelector(X),this.modalForm=document.querySelector(I),this.saveButton=this.modal.querySelector(j),this.cancelButtons=this.modal.querySelectorAll(Y),this.modalInputs=this.modal.querySelectorAll(p),this.groupElements=this.modal.querySelectorAll(W),this.initialize()}initialize(){this.cancelButtons.forEach(t=>{t.addEventListener("click",this.closeModal.bind(this))}),this.modalInputs.forEach(t=>{t.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),this.savePersonFromModal)})}),this.addButton.addEventListener("click",()=>this.handleAddButtonClick()),this.saveButton.addEventListener("click",()=>this.savePersonFromModal(!1)),this.closeModal(),this.savePersonFromModal(!1);let e=this.container.querySelectorAll(Z);for(let t=0;t<e.length;t++){let s=e[t];s.dataset.index=t.toString();let n=new b(s);this.accordionList.push(n),n.uiTrigger.addEventListener("click",()=>{this.openAccordion(t),setTimeout(()=>{n.scrollIntoView()},500)})}this.openAccordion(0)}openAccordion(e){for(let t=0;t<this.accordionList.length;t++){let s=this.accordionList[t];t===e&&!s.isOpen?s.open():t!==e&&s.isOpen&&s.close()}}handleAddButtonClick(){this.clearModal(),this.setLiveText("state","Hinzuf\xFCgen"),this.setLiveText("full-name","Neue Person"),this.openModal(),this.editingKey=null}savePersonFromModal(e=!0){if(!this.validateModal(e)&&(console.warn("Couldn't save person. Please fill in all the values correctly."),e))return null;let s=this.extractData();this.savePerson(s)&&(this.renderList(),this.closeModal())}savePerson(e){if(this.editingKey!==null)u.set(this.editingKey,e);else{let t=crypto.randomUUID(),s=`${H(e.getFullName())}-${t}`;u.set(s,e)}return!0}setLiveText(e,t){let s=this.modal.querySelectorAll(`[data-live-text="${e}"]`),n=!0;for(let i of s){if(!i){n=!1;break}i.innerText=t}return n}renderList(){this.list.innerHTML="",this.list.dataset.length=u.size.toString(),u.size?(u.forEach((e,t)=>this.renderPerson(e,t)),this.formMessage.reset()):this.formMessage.info("Bitte f\xFCgen Sie die mietenden personen hinzu.")}renderPerson(e,t){let s=this.template.cloneNode(!0),n=["full-name","phone","email","street","zip","city"];s.style.removeProperty("display");let i=s.querySelector('[data-person-action="edit"]'),r=s.querySelector('[data-person-action="delete"]');i.addEventListener("click",()=>{this.setLiveText("state","bearbeiten"),this.setLiveText("full-name",e.getFullName()||"Neue Person"),this.populateModal(e),this.openModal(),this.editingKey=t}),r.addEventListener("click",()=>{u.delete(t),this.renderList(),this.closeModal()}),n.forEach(a=>{let l=`[data-${a}]`,c=s.querySelector(l);if(c&&a==="full-name")c.innerText=e.getFullName();else if(c){let d=e.personalData.getField(a);if(!d){console.error(`Render person: A field for "${a}" doesn't exist.`);return}c.innerText=d.value||d.label}}),this.list.appendChild(s)}populateModal(e){this.groupElements.forEach(t=>{let s=t.querySelectorAll(p),n=t.dataset.personDataGroup;s.forEach(i=>{let r=e[n].getField(i.id);if(!r){console.warn("Field not found:",r,i.id);return}if(!f(i)&&!E(i)){i.value=r.value.trim();return}f(i)&&i.value===r.value&&(i.checked=r.checked,i.dispatchEvent(new Event("change",{bubbles:!0}))),E(i)&&(i.checked=r.checked,i.dispatchEvent(new Event("change",{bubbles:!0})))})})}validateArray(){let e=!0;return u.size===0?(console.warn("Bitte f\xFCgen Sie mindestens eine mietende Person hinzu."),this.formMessage.error("Bitte f\xFCgen Sie mindestens eine mietende Person hinzu."),e=!1):u.forEach((t,s)=>{t.validate()||(console.warn(`Person with key "${s}" is invalid.`),this.formMessage.error(`Bitte f\xFCllen Sie alle Felder f\xFCr "${t.getFullName()}" aus.`),e=!1)}),e}openModal(){this.modal.querySelector('[data-person-data-group="personalData"]').querySelectorAll("#first-name, #name").forEach(s=>{s.addEventListener("input",()=>{let n=this.extractData();this.setLiveText("full-name",n.getFullName()||"Neue Person")})}),this.formMessage.info(),this.openAccordion(0),this.modal.style.removeProperty("display"),this.modal.classList.remove("is-closed"),this.modal.dataset.state="open",document.body.style.overflow="hidden"}closeModal(){document.body.style.removeProperty("overflow"),this.modal.classList.add("is-closed"),this.modal.dataset.state="closed",this.list.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{this.modal.style.display="none"},500),this.clearModal()}clearModal(){this.setLiveText("state","hinzuf\xFCgen"),this.setLiveText("full-name","Neue Person"),this.modalInputs.forEach(e=>{f(e)?(e.checked=!1,oe(this.modal,e.name)):E(e)?(e.checked=!1,e.dispatchEvent(new Event("change",{bubbles:!0}))):e.value=""})}validateModal(e=!0){let t=this.modal.querySelectorAll(p),{valid:s,invalidField:n}=R(t,e);if(s===!0)return!0;if(n){let i=this.accordionIndexOf(n);return i!==-1&&(this.openAccordion(i),setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center"})},500)),!1}return!1}accordionIndexOf(e){let t=e.closest('[data-animate="accordion"]');if(t){let s=this.accordionList.findIndex(n=>n.component===t);return s!==-1?s:-1}return-1}extractData(){let e=new M;return this.groupElements.forEach(t=>{let s=t.querySelectorAll(p),n=t.dataset.personDataGroup;if(!e[n]){console.error(`The group "${n}" doesn't exist.`);return}s.forEach((i,r)=>{let a=new L(i,r);a.id&&e[n].fields.set(a.id,a)})}),console.log(e),e}};function H(o){return o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").replace(/-+/g,"-")}function h(o){let e={};for(let[t,s]of o)e[t]=s instanceof Map?h(s):s;return e}function ee(o){let e={};for(let[t,s]of o)e[t]={personalData:{fields:h(s.personalData.fields)},doctor:{fields:h(s.doctor.fields)},health:{fields:h(s.health.fields)},relatives:{fields:h(s.relatives.fields)}};return e}function f(o){return o instanceof HTMLInputElement&&o.type==="radio"}function E(o){return o instanceof HTMLInputElement&&o.type==="checkbox"}function te(o){if(!o)return console.error("Form component not found:",y),!1;let e=o.querySelector(I);if(!e)return console.error(`The selected form component does not contain a HTMLFormElement. Perhaps you added ${y} to the form element itself rather than its parent element?

Form Component:`,o),!1;ne(e),ie(o),re(o);let t=new w(o),s=new F(o,"personArray"),n=new A(o,["upload","post"],"validation message");return t.addCustomValidator(2,()=>n.validate()),t.addCustomValidator(1,()=>s.validateArray()),t.component.addEventListener("changeStep",()=>s.closeModal()),console.log(t.getAllFormData()),e.setAttribute("novalidate",""),e.dataset.state="initialized",o.addEventListener("submit",i=>{i.preventDefault(),n.validate(),t.validateAllSteps(),e.dataset.state="sending",se(o,e)}),!0}async function se(o,e){function t(){n&&(n.style.display="block"),e.style.display="none",e.dataset.state="success",e.dispatchEvent(new CustomEvent("formSuccess"))}function s(){i&&(i.style.display="block"),e.dataset.state="error",e.dispatchEvent(new CustomEvent("formError"))}let n=o.querySelector(q),i=o.querySelector(k),r=o.querySelector(_);if(!(r instanceof HTMLInputElement)||r.type!=="submit")throw new Error('The submitButton element is not an HTML input element with type="submit".');r.dataset.defaultText=r.value,r.value=r.dataset.wait||"Wird gesendet ...";let a=[];a.people=ee(u),console.log("FORM FIELDS:",a),window.PEAKPOINT.fields=a;let l=e.querySelector("#g-recaptcha-response").value,c={name:e.dataset.name,pageId:Q,elementId:e.dataset.wfElementId,source:window.location.href,test:!1,fields:{fields:JSON.stringify({fields:a}),"g-recaptcha-response":l},dolphin:!1};r.value=r.dataset.defaultText}function ne(o){o.querySelectorAll("button").forEach(t=>{t.setAttribute("type","button"),t.addEventListener("click",s=>{})})}function oe(o,e){o.querySelectorAll(`${P}[name="${e}"]`).forEach(t=>{t.checked=!1;let s=t.closest(".w-radio")?.querySelector(g);s&&s.classList.remove(v)})}function ie(o){let e="w--redirected-focus",t="w--redirected-focus-visible",s=":focus-visible, [data-wf-focus-visible]",n=[["checkbox",T],["radio",g]];o.querySelectorAll(N).forEach(i=>{i.addEventListener("change",r=>{let a=r.target,l=a.closest(".w-checkbox")?.querySelector(T);l&&l.classList.toggle(v,a.checked)})}),o.querySelectorAll('input[type="radio"]').forEach(i=>{i.addEventListener("change",r=>{let a=r.target;if(!a.checked)return;let l=a.name;o.querySelectorAll(`input[type="radio"][name="${l}"]`).forEach(d=>{let O=d.closest(".w-radio")?.querySelector(g);O&&O.classList.remove(v)});let c=a.closest(".w-radio")?.querySelector(g);c&&c.classList.add(v)})}),n.forEach(([i,r])=>{o.querySelectorAll(`input[type="${i}"]:not(${r})`).forEach(a=>{a.addEventListener("focus",l=>{let c=l.target,d=c.closest(".w-checkbox, .w-radio")?.querySelector(r);d&&(d.classList.add(e),c.matches(s)&&d.classList.add(t))}),a.addEventListener("blur",l=>{let d=l.target.closest(".w-checkbox, .w-radio")?.querySelector(r);d&&d.classList.remove(e,t)})})})}function re(o){o.querySelectorAll("[data-decision-group]").forEach(t=>{let s=t.querySelectorAll("input[data-decision]"),n=t.dataset.decisionGroup,i=document.querySelector(`[data-decision-extra-fields="${n}"]`);if(s.length===0){console.error(`Decision group "${n}" does not contain any decision input elements.`);return}if(!i){console.error(`Extra fields container for decision group "${n}" not found.`);return}i.style.display="none",t.addEventListener("change",r=>{let a=r.target;a.matches("input[data-decision]")&&a.dataset.decision==="show"?i.style.display="block":i.style.display="none"})})}function R(o,e=!0){let t=!0,s=null;for(let n of o)if(n.checkValidity())n.classList.remove("has-error");else{t=!1,e&&!s&&(n.reportValidity(),n.classList.add("has-error"),n.addEventListener("change",()=>{n.classList.remove("has-error")},{once:!0}),s=n);break}return{valid:t,invalidField:s}}window.PEAKPOINT={};var u=new Map;window.PEAKPOINT.people=u;var C=document.querySelector(y);C?.classList.remove("w-form");document.addEventListener("DOMContentLoaded",()=>{if(window.location.search){let e=new URLSearchParams(window.location.search),t=document.querySelector("#wohnung"),s=e.get("wohnung"),n=t.querySelector(`option[value="${s}"]`);s&&n?t.value=s:console.warn(`No matching option for value: ${s}`)}let o=te(C);console.log("Form initialized:",o)});})();
