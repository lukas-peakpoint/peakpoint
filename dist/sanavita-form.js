(()=>{var q=".w-checkbox-input",C=".w-radio-input",H="w--redirected-checked",P='[data-form-element="component"]',Y="form",re='[data-form-element="success"]',ae='[data-form-element="error"]',ie='[data-form-element="submit"]',j=`.w-checkbox input[type="checkbox"]:not(${q})`,U='.w-radio input[type="radio"]',y=`.w-input, .w-select, ${U}, ${j}`,le='[data-steps-element="component"]',ce='[data-steps-element="list"]',de='[data-steps-element="step"]';var ue="button[data-step-target]",me='[data-steps-nav="prev"]',pe='[data-steps-nav="next"]';var we=document.documentElement.dataset.wfSite||"",fe=document.documentElement.dataset.wfPage||"",b=class{fields;constructor(e=new Map){this.fields=e}getField(e){return this.fields.get(e)}},_=class{personalData;doctor;health;relatives;constructor(e=new b,t=new b,n=new b,o=new b){this.personalData=e,this.doctor=t,this.health=n,this.relatives=o}getFullName(){return`${this.personalData.getField("first-name").value} ${this.personalData.getField("name").value}`.trim()}},I=class{id;label;value;required;type;checked;constructor(e,t){e.type==="radio"&&!e.checked||(this.id=e.id||he(e.dataset.name||`field ${t}`),this.label=e.dataset.name||`field ${t}`,this.value=e.value,this.required=e.required||!1,this.type=e.type,(A(e)||w(e))&&(this.checked=e.checked))}},k=class{container;messageFor;messageElement;constructor(e,t){this.container=e,this.messageFor=t,this.messageElement=this.container.querySelector(`[data-message-component="FormGroup"][data-message-for="${t}"]`),this.reset()}info(e=null){this.setMessage(e,"info")}error(e=null){this.setMessage(e,"error")}reset(){this.messageElement?this.messageElement.classList.remove("info","error"):console.warn("Message element not found.")}setMessage(e=null,t){if(!this.messageElement){console.warn("Message element not found.");return}let n=this.messageElement.querySelector('[data-message-element="message"]');n&&e?n.textContent=e:n||console.warn("Message text element not found."),this.messageElement.classList.remove("info","error"),this.messageElement.classList.add(t)}},D=class{form;container;groupNames;validationMessage;formMessage;constructor(e,t,n){this.container=e,this.groupNames=t,this.validationMessage=n;let o=this.getAllGroupFields()[0].closest("form");if(!o){console.error("Cannot construct a FormGroup that is not part of a form.");return}this.form=o,this.formMessage=new k(this.form,this.groupNames.join(",")),this.initialize()}initialize(){this.getAllGroupFields().forEach(t=>{t.addEventListener("change",()=>this.formMessage.reset())})}getGroupFields(e){return this.container.querySelectorAll(`[data-form-group="${e}"]`)}getAllGroupFields(){let t=this.groupNames.map(n=>`[data-form-group="${n}"]`).join(", ");return this.container.querySelectorAll(t)}validate(){console.log("VALIDATING FORM GROUPS: ",this.groupNames);let e=this.checkGroupValidity();return this.handleValidationMessages(e),console.log(e),e}checkGroupValidity(){return this.groupNames.some(e=>Array.from(this.getGroupFields(e)).some(n=>w(n)||A(n)?n.checked:n.value.trim()!==""))}updateRequiredAttributes(e){this.getAllGroupFields().forEach(n=>{n.required=!e}),this.formMessage.reset()}handleValidationMessages(e){e?this.formMessage.reset():this.formMessage.error()}},G=class{component;formSteps;paginationItems;buttonNext;buttonPrev;currentStep=0;customValidators=[];constructor(e){this.component=e,this.formSteps=this.component.querySelectorAll(de),this.paginationItems=this.component.querySelectorAll(ue),this.buttonNext=this.component.querySelector(pe),this.buttonPrev=this.component.querySelector(me),this.initialize()}addCustomValidator(e,t){this.customValidators[e]||(this.customValidators[e]=[]),this.customValidators[e].push(t)}initialize(){if(!this.component.getAttribute("data-steps-element")){console.error(`Form Steps: Component is not a steps component or is missing the attribute ${le}.
Component:`,this.component);return}if(!this.formSteps.length){console.warn("Form Steps: The selected list doesn't contain any steps. Skipping initialization. Provided List:",this.component.querySelector(ce));return}this.setupSteps(),this.initPagination(),this.changeToStep(this.currentStep,!0)}setupSteps(){this.formSteps.forEach((e,t)=>{e.dataset.stepId=t.toString(),e.classList.toggle("hide",t!==0)})}initPagination(){this.paginationItems.forEach((e,t)=>{e.dataset.stepTarget=t.toString(),e.addEventListener("click",n=>{n.preventDefault(),this.changeToStep(t)})}),this.buttonNext.addEventListener("click",e=>{e.preventDefault(),this.currentStep<this.formSteps.length-1&&this.changeToStep(this.currentStep+1)}),this.buttonPrev.addEventListener("click",e=>{e.preventDefault(),this.currentStep>0&&this.changeToStep(this.currentStep-1)})}changeToStep(e,t=!1){if(this.currentStep===e&&!t){console.log("Change Form Step: Target step equals current step.");return}if(e>this.currentStep&&!t){for(let o=this.currentStep;o<e;o++)if(!this.validateCurrentStep(o)){console.warn("Standard validation failed for step:",o+1),this.changeToStep(o);return}this.component.scrollIntoView({behavior:"smooth"})}let n=new CustomEvent("stepChanged",{detail:{previousStep:this.currentStep,currentStep:e}});this.component.dispatchEvent(n),this.updateStepVisibility(e),this.updatePagination(e),this.currentStep=e}updateStepVisibility(e){this.formSteps[this.currentStep].classList.add("hide"),this.formSteps[e].classList.remove("hide")}updatePagination(e){this.buttonPrev.style.opacity=e===0?"0":"1",this.buttonNext.style.opacity=e===this.formSteps.length-1?"0":"1",this.paginationItems.forEach((t,n)=>{t.classList.toggle("is-done",n<e),t.classList.toggle("is-active",n===e)})}validateAllSteps(){let e=!0;return this.formSteps.forEach((t,n)=>{this.validateCurrentStep(n)||(console.warn(`Step ${n+1} is invalid.`),e=!1,this.changeToStep(n))}),e}validateCurrentStep(e){let t=this.formSteps[e],n=t.querySelectorAll(y),o=W(n);if(!o)return console.warn("STANDARD VALIDATION: NOT VALID"),o;let l=this.customValidators[e]?.every(i=>i())??!0;if(!l)return console.warn("CUSTOM VALIDATION: NOT VALID"),o&&l;let d=t.querySelector('[data-form-array-element="list"]');if(!d)return o&&l;let a=parseInt(d.dataset.length)>0;if(!a){console.warn("Couldn't validate current step. Please add at least one person.");let i=d.parentElement.querySelector('[data-person-element="empty"]');i.setAttribute("aria-live","assertive"),i.setAttribute("role","alert"),i.setAttribute("tabindex","-1"),i.classList.add("has-error"),ge(i)}return o&&l&&a}};function he(s){return s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").replace(/-+/g,"-")}function M(s){let e={};for(let[t,n]of s)e[t]=n instanceof Map?M(n):n;return e}function Ee(s){let e={};for(let[t,n]of s)e[t]={personalData:{fields:M(n.personalData.fields)},doctor:{fields:M(n.doctor.fields)},health:{fields:M(n.health.fields)},relatives:{fields:M(n.relatives.fields)}};return e}function ge(s){if(!s||!s.firstElementChild){console.warn("Element or its first element child is not defined.");return}let e=s.firstElementChild;s.removeChild(e),setTimeout(()=>{s.appendChild(e),s.focus()},0)}function A(s){return s instanceof HTMLInputElement&&s.type==="radio"}function w(s){return s instanceof HTMLInputElement&&s.type==="checkbox"}function Se(s){if(!s)return console.error("Form component not found:",P),!1;let e=s.querySelector(Y);if(!e)return console.error(`The selected form component does not contain a HTMLFormElement. Perhaps you added ${P} to the form element itself rather than its parent element?

Form Component:`,s),!1;ve(e),Me(s),ye(s),be(s);let t=new G(s),n=new D(s,["upload","post"],"validation message");return t.addCustomValidator(2,()=>n.validate()),e.setAttribute("novalidate",""),e.dataset.state="initialized",s.addEventListener("submit",o=>{o.preventDefault(),n.validate(),t.validateAllSteps(),e.dataset.state="sending",Le(s,e)}),!0}async function Le(s,e){function t(){d&&(d.style.display="block"),e.style.display="none",e.dataset.state="success",e.dispatchEvent(new CustomEvent("formSuccess"))}function n(){u&&(u.style.display="block"),e.dataset.state="error",e.dispatchEvent(new CustomEvent("formError"))}let o=[{id:"custom-submit",label:"Custom Submit",value:!0,required:!1}],l=e.querySelectorAll(y),d=s.querySelector(re),u=s.querySelector(ae),a=s.querySelector(ie);if(!(a instanceof HTMLInputElement)||a.type!=="submit")throw new Error('The submitButton element is not an HTML input element with type="submit".');a.dataset.defaultText=a.value,a.value=a.dataset.wait||"Wird gesendet ...",l.forEach((L,R)=>{let p=new I(L,R);o.push()}),o.people=Ee(S),console.log("FORM FIELDS:",o),window.PEAKPOINT.fields=o;let i=e.querySelector("#g-recaptcha-response").value,E={name:e.dataset.name,pageId:fe,elementId:e.dataset.wfElementId,source:window.location.href,test:!1,fields:{fields:JSON.stringify({fields:o}),"g-recaptcha-response":i},dolphin:!1};a.value=a.dataset.defaultText}function ve(s){s.querySelectorAll("button").forEach(t=>{t.setAttribute("type","button"),t.addEventListener("click",n=>{})})}function Te(s,e){s.querySelectorAll(`${U}[name="${e}"]`).forEach(t=>{t.checked=!1;let n=t.closest(".w-radio")?.querySelector(C);n&&n.classList.remove(H)})}function ye(s){let e="w--redirected-focus",t="w--redirected-focus-visible",n=":focus-visible, [data-wf-focus-visible]",o=[["checkbox",q],["radio",C]];s.querySelectorAll(j).forEach(l=>{l.addEventListener("change",d=>{let u=d.target,a=u.closest(".w-checkbox")?.querySelector(q);a&&a.classList.toggle(H,u.checked)})}),s.querySelectorAll('input[type="radio"]').forEach(l=>{l.addEventListener("change",d=>{let u=d.target;if(!u.checked)return;let a=u.name;s.querySelectorAll(`input[type="radio"][name="${a}"]`).forEach(E=>{let L=E.closest(".w-radio")?.querySelector(C);L&&L.classList.remove(H)});let i=u.closest(".w-radio")?.querySelector(C);i&&i.classList.add(H)})}),o.forEach(([l,d])=>{s.querySelectorAll(`input[type="${l}"]:not(${d})`).forEach(u=>{u.addEventListener("focus",a=>{let i=a.target,E=i.closest(".w-checkbox, .w-radio")?.querySelector(d);E&&(E.classList.add(e),i.matches(n)&&E.classList.add(t))}),u.addEventListener("blur",a=>{let E=a.target.closest(".w-checkbox, .w-radio")?.querySelector(d);E&&E.classList.remove(e,t)})})})}function be(s){s.querySelectorAll("[data-decision-group]").forEach(t=>{let n=t.querySelectorAll("input[data-decision]"),o=t.dataset.decisionGroup,l=document.querySelector(`[data-decision-extra-fields="${o}"]`);if(n.length===0){console.error(`Decision group "${o}" does not contain any decision input elements.`);return}if(!l){console.error(`Extra fields container for decision group "${o}" not found.`);return}l.style.display="none",t.addEventListener("change",d=>{let u=d.target;u.matches("input[data-decision]")&&u.dataset.decision==="show"?l.style.display="block":l.style.display="none"})})}function W(s){let e=!0;for(let t of s)if(t.checkValidity())t.classList.remove("has-error");else{e=!1,t.reportValidity(),t.classList.add("has-error"),t.addEventListener("change",()=>{t.classList.remove("has-error")});break}return e}function Me(s){let e='[data-form-array-element="list"]',t='[data-person-element="template"]',n='[data-person-element="empty"]',o='[data-person-element="add"]',l='[data-person-element="save"]',d='[data-person-element="cancel"]',u='[data-form-element="modal"]',a="[data-person-data-group]",i=s.querySelector(e),E=i.querySelector(t),L=s.querySelector(n),R=s.querySelector(o),p=document.querySelector(u),Ae=document.querySelector(Y),J=p.querySelector(l),Z=p.querySelectorAll(d),Q=p.querySelectorAll(y),$=p.querySelectorAll(a),O=null;Z.forEach((r,m)=>{r.addEventListener("click",F)}),R.addEventListener("click",()=>{z(),v("state","Hinzuf\xFCgen"),v("full-name","Neue Person"),x(),O=null}),J.addEventListener("click",ee);function ee(){if(!ne())return console.warn("Couldn't save person. Please fill in all the values correctly."),null;let r=B();if(O!==null)S.set(O,r);else{let m=`person${S.size+1}`;S.set(m,r)}return V(),F(),r}function v(r,m){let f=p.querySelectorAll(`[data-live-text="${r}"]`),h=!0;for(let c of f){if(!c){h=!1;break}c.innerText=m}return h}function V(){i.innerHTML="",i.dataset.length=S.size.toString(),console.log(S.size.toString()),S.size?(S.forEach((r,m)=>te(r,m)),L.classList.add("hide")):L.classList.remove("hide")}function te(r,m){let f=E.cloneNode(!0),h=["first-name","name","phone","email","street","zip","city"];f.style.removeProperty("display");let c=f.querySelector('[data-person-action="edit"]'),g=f.querySelector('[data-person-action="delete"]');c.addEventListener("click",()=>{v("state","bearbeiten"),v("full-name",r.getFullName()||"Neue Person"),se(r),x(),O=m}),g.addEventListener("click",()=>{S.delete(m),V(),F()}),h.forEach(T=>{let oe=`[data-${T}]`,K=f.querySelector(oe);if(K){let N=r.personalData.getField(T);if(!N){console.error(`Render person: A field for "${T}" doesn't exist.`);return}K.innerText=N.value||N.label}}),i.appendChild(f)}function se(r){$.forEach(m=>{let f=m.querySelectorAll(y),h=m.dataset.personDataGroup;f.forEach(c=>{let g=r[h].getField(c.id);if(!g){console.warn("Field not found:",g,c.id);return}if(!A(c)&&!w(c)){c.value=g.value.trim();return}A(c)&&c.value===g.value&&(c.checked=g.checked,c.dispatchEvent(new Event("change",{bubbles:!0}))),w(c)&&(c.checked=g.checked,c.dispatchEvent(new Event("change",{bubbles:!0})))})})}function x(){p.querySelector('[data-person-data-group="personalData"]').querySelectorAll("#first-name, #name").forEach(f=>{f.addEventListener("input",()=>{let h=B();v("full-name",h.getFullName()||"Neue Person")})}),L.classList.remove("has-error"),p.style.removeProperty("display"),p.classList.remove("is-closed"),p.dataset.state="open"}function F(){p.classList.add("is-closed"),p.dataset.state="closed",setTimeout(()=>{p.style.display="none"},500),z()}function z(){v("state","hinzuf\xFCgen"),v("full-name","Neue Person"),Q.forEach(r=>{A(r)?(r.checked=!1,Te(p,r.name)):w(r)?(r.checked=!1,r.dispatchEvent(new Event("change",{bubbles:!0}))):r.value=""})}function ne(){let r=p.querySelectorAll(y),m=W(r);return!0}function B(){let r=new _;return $.forEach(m=>{let f=m.querySelectorAll(y),h=m.dataset.personDataGroup;if(!r[h]){console.error(`The group "${h}" doesn't exist.`);return}f.forEach((c,g)=>{let T=new I(c,g);T.id&&r[h].fields.set(T.id,T)})}),console.log(r),r}F()}window.PEAKPOINT={};var S=new Map;window.PEAKPOINT.people=S;var X=document.querySelector(P);X?.classList.remove("w-form");document.addEventListener("DOMContentLoaded",()=>{let s=Se(X);console.log("Form initialized:",s)});})();
